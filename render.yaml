services:
- type: web
  name: slci-chatbot
  env: python
  plan: free
  buildCommand: |
    # Force Python 3.10
    python --version
    pip install --upgrade pip setuptools wheel
    pip install -r requirements.txt
    python --version  # Verify version after build
  startCommand: gunicorn app:app --bind 0.0.0.0:$PORT --workers 3 --timeout 120 --log-level info
  envVars:
    # CRITICAL: Set Python version in multiple places
    - key: PYTHON_VERSION
      value: "3.10.11"
    - key: PIP_DEFAULT_TIMEOUT
      value: "100"
    - key: SECRET_KEY
      generateValue: true
    - key: DB_HOST
      sync: false
    - key: DB_PORT
      value: "5432"
    - key: DB_NAME
      sync: false
    - key: DB_USER
      sync: false
    - key: DB_PASSWORD
      sync: false
    - key: OLLAMA_HOST
      value: http://localhost:11434
    - key: OLLAMA_MODEL
      value: mistral
    - key: EMAIL_HOST
      value: smtp.gmail.com
    - key: EMAIL_PORT
      value: "587"
    - key: EMAIL_USER
      sync: false
    - key: EMAIL_PASSWORD
      sync: false
    - key: GOOGLE_SHEET_ID
      sync: false
    - key: GOOGLE_SHEET_ENABLED
      value: "true"